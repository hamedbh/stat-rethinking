---
title: "Chapter 3: Sampling the Imaginary"
output: 
  html_document: 
    highlight: kate
    theme: journal
---

```{r}
library(ggplot2)
library(dplyr)
library(rethinking)
```

# Easy

```{r}
p_grid <- seq(from = 0,
              to = 1,
              length.out = 1000)
prior <- rep(1, 1000)
likelihood <- dbinom(6 , size = 9 , prob = p_grid)
posterior <- likelihood * prior
posterior <- posterior / sum(posterior)
set.seed(100)
samples <- sample(p_grid,
                  prob = posterior,
                  size = 1e4,
                  replace = TRUE)
```

3E1. How much posterior probability lies below p = 0.2?

```{r}
sum(samples < 0.2)/length(samples)
```

3E2. How much posterior probability lies above p = 0.8?

```{r}
sum(samples > .8)/length(samples)
```

3E3. How much posterior probability lies between p = 0.2 and p = 0.8? 

```{r}
sum(samples > 0.2 & samples < 0.8)/length(samples)
```

3E4. 20% of the posterior probability lies below which value of p?

```{r}
quantile(samples, 0.2)
```

3E5. 20% of the posterior probability lies above which value of p?

```{r}
quantile(samples, 0.8)
```
3E6. Which values of p contain the narrowest interval equal to 66% of the posterior probability?

```{r}
HPDI(samples, prob = 0.66)
```

3E7. Which values of p contain 66% of the posterior probability, assuming equal posterior probabil- ity both below and above the interval?

```{r}
PI(samples, prob = 0.66)
```

# Medium

3M1. Suppose the globe tossing data had turned out to be 8 water in 15 tosses. Construct the posterior distribution, using grid approximation. Use the same flat prior as before.

```{r}
p_grid <- seq(from = 0,
              to = 1,
              length.out = 1000)
prior <- rep(1, 1000)
likelihood <- dbinom(8, size = 15, prob = p_grid)
posterior <- likelihood * prior
posterior <- posterior / sum(posterior)
```

3M2. Draw 10,000 samples from the grid approximation from above. Then use the samples to cal-
culate the 90% HPDI for p.

```{r}
set.seed(100)
samples <- sample(p_grid,
                  prob = posterior,
                  size = 1e4,
                  replace = TRUE)
HPDI(samples, .9)
```

3M3. Construct a posterior predictive check for this model and data. This means simulate the distribution of samples, averaging over the posterior uncertainty in p. What is the probability of observing 8 water in 15 tosses?

```{r}
PPD <- rbinom(n = length(samples), size = 15, prob = samples)
mean(PPD == 8)
```

3M4. Using the posterior distribution constructed from the new (8/15) data, now calculate the probability of observing 6 water in 9 tosses.

```{r}
PPD <- rbinom(n = length(samples), size = 9, prob = samples)
mean(PPD == 6)
```

3M5. Start over at 3M1, but now use a prior that is zero below p = 0.5 and a constant above p = 0.5. This corresponds to prior information that a majority of the Earthâ€™s surface is water. Repeat each problem above and compare the inferences. What difference does the better prior make? If it helps, compare inferences (using both priors) to the true value p = 0.7.

Q1.

```{r}
p_grid <- seq(from = 0,
              to = 1,
              length.out = 1000)
prior <- as.numeric(!p_grid < 0.5)
likelihood <- dbinom(8, size = 15, prob = p_grid)
posterior <- likelihood * prior
posterior <- posterior / sum(posterior)
```

Q2. 

```{r}
set.seed(100)
samples <- sample(p_grid,
                  prob = posterior,
                  size = 1e4,
                  replace = TRUE)
HPDI(samples, .9)
```

Q3.

```{r}
PPD <- rbinom(n = length(samples), size = 15, prob = samples)
mean(PPD == 8)
```

Q4.

```{r}
PPD <- rbinom(n = length(samples), size = 9, prob = samples)
mean(PPD == 6)
```

# Hard

```{r}
data(homeworkch3)
```

3H1.

```{r}
boys <- sum(birth1, birth2)
births <- length(birth1) + length(birth2)
girls <- births - boys
prior <- rep(x = 1, times = length(p_grid))
likelihood <- dbinom(x = boys, size = births, prob = p_grid)
posterior <- prior * likelihood
posterior <- posterior/sum(posterior)
plot(posterior ~ p_grid, type = "l")
p_grid[which.max(posterior)]
```

3H2.

```{r}
samples <- sample(x = p_grid, size = 1e4, replace = TRUE, prob = posterior)
HPDI(samples, c(.5, .89, .97))
```


3H3.

```{r}
PPD <- rbinom(n = 1e4, size = births, prob = samples)
dens(PPD)
abline(v = boys)
```

3H4.

Two ways to interpret. Can draw from the samples we have already.
```{r}
PPD <- rbinom(n = 1e4, size = 100, prob = samples)
dens(PPD)
abline(v = sum(birth1))
```

Or set up a new likelihood, posterior and PPD for just first births.

```{r}
likelihood <- dbinom(x = sum(birth1), size = 100, prob = p_grid)
posterior <- likelihood * prior
posterior <- posterior/sum(posterior)
samples <- sample(p_grid, size = 1e4, replace = TRUE, prob = posterior)
PPD <- rbinom(n = 1e4, size = 100, prob = samples)
dens(PPD)
abline(v = sum(birth1))
```

3H5.

```{r}
girl_first <- !birth1
has_big_sister <- birth2[girl_first]
PPD <- rbinom(n = 1e4, size = sum(girl_first), prob = samples)
dens(PPD)
abline(v = sum(has_big_sister))
```

